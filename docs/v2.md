# Spendly - Concepto Unificado para Hackathon
**Versión 2.0 - Frictionless Smart Spending**

---

## Visión General

Spendly es una aplicación de finanzas personales inteligentes que ayuda a los usuarios a gestionar sus gastos de manera **invisible y sin esfuerzo**, con un enfoque especial en la sustentabilidad financiera y ambiental. La app conecta el control de gastos personales con el impacto ecológico a través de **recopilación automática de datos** y **recomendaciones proactivas impulsadas por IA**.

### 🎯 Diferenciador Clave v2.0
**"Spendly trabaja para ti, no tú para Spendly"**

A diferencia de apps tradicionales que requieren registro manual constante, Spendly utiliza:
- **Integración bancaria automática** para capturar transacciones sin intervención
- **WhatsApp Bot conversacional** para registros ultra-rápidos en lenguaje natural
- **IA predictiva** que aprende patrones y sugiere registros automáticamente
- **Notificaciones inteligentes** con consejos contextuales en el momento perfecto

***

## Concepto Central: Smart Spending Sostenible Sin Fricción

Spendly combina tres pilares fundamentales:

1. **Finanzas Pasivas**: Recopilación automática con mínima intervención del usuario
2. **Inteligencia Contextual**: IA que entiende patrones, predice gastos y recomienda alternativas
3. **Impacto Dual Visible**: Cada decisión muestra su efecto financiero Y ambiental en tiempo real

---

## Objetivos y Metas

### Objetivo Principal
Empoderar a los usuarios para tomar decisiones de gasto más inteligentes que beneficien tanto su economía personal como el medio ambiente, **sin requerir esfuerzo ni disciplina diaria**.

### Metas Específicas
1. **Transparencia Automática**: El usuario entiende exactamente en qué gasta sin necesidad de registrar manualmente
2. **Captura Completa**: 80%+ de transacciones registradas automáticamente
3. **Impacto Medible**: Visualizar el impacto ambiental de cada decisión de consumo
4. **Cambio de Comportamiento**: Motivar decisiones sostenibles a través de notificaciones inteligentes en el momento justo
5. **Ahorro Eficiente**: Reducir gastos innecesarios en un 15-30% mediante recomendaciones contextuales

***

## Funcionalidades Core (MVP para Hackathon)

### 1. Dashboard de Doble Impacto Inteligente

La pantalla principal se actualiza automáticamente y muestra dos dimensiones de cada gasto:

#### Panel Financiero:
- **Gasto total del mes** con comparativa vs. mes anterior
- **Gráfica interactiva** de gastos por categoría (visual e intuitiva)
- **Análisis de cashflow**: Ingresos vs. Egresos automático
- **Proyección predictiva**: "A este ritmo, gastarás $2,850 este mes" (basado en IA)
- **Alertas proactivas**: "⚠️ Transporte está 40% arriba vs. mes pasado"

#### Panel Ecológico:
- **Huella de carbono total del mes** (en kg de CO2)
- **Top 3 de emisiones**: Las categorías que más impacto tienen
- **Comparativa visual**: Tu huella vs. promedio nacional
- **Equivalencia tangible**: "Tus gastos de transporte equivalen a plantar 12 árboles 🌳"
- **Tendencia mensual**: Gráfica de evolución de huella ecológica

#### Features Nuevos:
- **Resumen semanal automático**: Notificación cada domingo con análisis
- **Modo "Piloto Automático"**: Badge que indica % de gastos capturados sin intervención
- **Streak de sostenibilidad**: Días consecutivos reduciendo huella de carbono

***

### 2. Sistema de Recopilación Sin Fricción (Multinivel)

El corazón de Spendly v2.0 es su **arquitectura de captura híbrida** que se adapta a cada situación:

#### 🔹 Nivel 1: Automático (0 esfuerzo) - 80% de transacciones

**A. Integración Bancaria Inteligente**

```
Configuración inicial (Una sola vez):
1. Usuario conecta su banco vía API (Plaid/Belvo/Fintoc)
2. Autoriza acceso de lectura a transacciones
3. Spendly sincroniza automáticamente cada 24hrs
```

**Flujo de usuario:**
```
Usuario realiza compra con tarjeta/débito
    ↓
Banco procesa transacción
    ↓
Spendly detecta nueva transacción (sync automático)
    ↓
IA categoriza: "Uber - $150 MXN → Transporte 🚗"
    ↓
Usuario recibe notificación (opcional):
"💳 Nueva transacción: $150 | Transporte | 60kg CO2
💡 DiDi te hubiera ahorrado $30 y 10kg CO2"
    ↓
Usuario puede: ✅ Confirmar | ✏️ Editar | ❌ Ignorar
```

**Datos capturados automáticamente:**
- Monto exacto
- Comercio/Descripción
- Fecha y hora
- Método de pago
- Categorización automática con IA

**Para el Hackathon (Simulación):**
```javascript
// Mock de API bancaria con datos realistas
const mockTransactions = [
  {
    id: "tx_001",
    amount: 150.00,
    merchant: "UBER *TRIP",
    date: "2025-10-24T08:30:00",
    category: "auto-detected", // IA categoriza
    raw_description: "UBER *TRIP HELP.UBER.COM"
  },
  // ... más transacciones
];

// Demo muestra:
// 1. Dashboard con transacciones "importadas"
// 2. Animación de sync automático
// 3. Categorización en tiempo real
```

***

**B. Detección de Gastos Recurrentes**

```javascript
// IA detecta patrones automáticamente
if (usuario.paga("Netflix", frecuencia="mensual", monto="$199")) {
  // Registra automáticamente sin preguntar
  // Solo notifica la primera vez:
  "✅ Detectamos suscripción: Netflix $199/mes
   Lo registraremos automáticamente. ¿Correcto?"
}

// Ejemplos de patrones:
- Suscripciones (Netflix, Spotify, gym)
- Gastos de transporte rutinarios (Uber al trabajo)
- Compras recurrentes (súper los sábados)
```

***

#### 🔹 Nivel 2: Semi-Automático (1-3 segundos) - 15% de transacciones

**A. WhatsApp Bot Conversacional**

El método más rápido para gastos en efectivo o cuando el usuario prefiere control inmediato.

**Configuración:**
```
1. Usuario escanea QR en la app
2. Guarda número de Spendly en contactos
3. Envía primer mensaje: "Hola"
4. Bot responde: "¡Listo! Ahora solo envíame tus gastos 💰"
```

**Ejemplos de uso:**

```
👤 Usuario: "80 pesos uber"
🤖 Spendly: ✅ Registrado: $80 MXN | Transporte | 32kg CO2
            💡 Metro = -$65 / -30kg CO2
            🎯 Llevas $230 en transporte esta semana

👤 Usuario: "Comí en mcdonalds 120"
🤖 Spendly: ✅ Registrado: $120 MXN | Alimentación | 36kg CO2
            🌱 Meal prep ahorra ~$90/comida
            📊 Gasto en comida hoy: $120

👤 Usuario: "200 super oxxo"
🤖 Spendly: ✅ Registrado: $200 MXN | Alimentación | 30kg CO2
            ✨ Bien! Supermercado es 40% más eco que restaurantes

👤 Usuario: "starbucks 75"
🤖 Spendly: ✅ Registrado: $75 MXN | Alimentación | 22.5kg CO2
            ☕ Llevas 3 visitas a cafeterías esta semana ($210)
            💰 Café casero ahorra $180/semana

👤 Usuario: "¿cuánto llevo gastado?"
🤖 Spendly: 📊 Resumen de Octubre:
            💰 Total: $2,340 MXN
            🌍 CO2: 780kg
            📈 15% menos que septiembre ¡Excelente!
            
            Top gastos:
            1. Transporte: $890
            2. Alimentación: $670
            3. Entretenimiento: $450
```

**Capacidades del Bot:**
- **Lenguaje natural**: Entiende "pagué", "gasté", "compré", emojis
- **Contexto flexible**: Acepta formatos variados ("80 uber" o "uber 80 pesos")
- **Feedback instantáneo**: Responde en <2 segundos
- **Comandos útiles**: 
  - "resumen" → Estadísticas del mes
  - "consejo" → Recomendación personalizada
  - "huella" → Análisis de impacto ambiental
  - "ahorro" → Cuánto podrías ahorrar

**Implementación Técnica:**
```javascript
// Stack: Twilio WhatsApp API + GPT-4o-mini

// Webhook que recibe mensaje
app.post('/webhook/whatsapp', async (req, res) => {
  const userMessage = req.body.Body;
  const userPhone = req.body.From;
  
  // Procesar con IA
  const categorization = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    messages: [{
      role: "system",
      content: `Eres Spendly, un asistente financiero. 
      Extrae: monto, categoría, descripción del mensaje.
      Formato JSON: {amount, category, description}`
    }, {
      role: "user",
      content: userMessage
    }]
  });
  
  // Guardar en DB
  await saveTransaction(categorization);
  
  // Generar respuesta personalizada con consejos
  const advice = await generateSmartAdvice(user, categorization);
  
  // Enviar respuesta por WhatsApp
  await twilioClient.messages.create({
    body: advice,
    from: 'whatsapp:+14155238886',
    to: userPhone
  });
});
```

***

**B. Escaneo OCR Inteligente de Tickets**

Perfecto para comercios locales sin integración digital.

**Flujo mejorado:**
```
Usuario toma foto del ticket desde la app
    ↓
IA procesa imagen (2-3 segundos)
    ↓
Extrae automáticamente:
  - Monto total: $125.50
  - Comercio: "Tacos El Güero"
  - Fecha: 24/10/2025
  - Items (opcional): Tacos x3, Refresco
    ↓
Categoriza inteligentemente:
  "Tacos" → Alimentación (Fast Food)
    ↓
Muestra preview:
┌─────────────────────────────┐
│ 📄 Ticket Detectado         │
│                             │
│ Tacos El Güero              │
│ $125.50 MXN                 │
│ Alimentación 🍽️             │
│ 24 Oct 2025                 │
│                             │
│ CO2: 37.65kg                │
│                             │
│    [✅ Confirmar]  [✏️ Editar] │
└─────────────────────────────┘
```

**Capacidades avanzadas:**
- **Detección multi-idioma**: Español, inglés
- **Corrección automática**: Entiende tickets borrosos o mal impresos
- **Detección de propinas**: Separa propina del total
- **Histórico visual**: Guarda foto del ticket para referencia

**Tecnología:**
```javascript
// Opción 1: Google Cloud Vision API (más preciso)
const vision = require('@google-cloud/vision');
const client = new vision.ImageAnnotatorClient();

async function processReceipt(imageBuffer) {
  const [result] = await client.textDetection(imageBuffer);
  const fullText = result.fullTextAnnotation.text;
  
  // Pasar a GPT-4 Vision para estructurar
  const structured = await openai.chat.completions.create({
    model: "gpt-4-vision-preview",
    messages: [{
      role: "user",
      content: [
        { type: "text", text: "Extrae: total, comercio, fecha, items" },
        { type: "image_url", image_url: imageBuffer }
      ]
    }]
  });
  
  return structured;
}

// Opción 2: Tesseract.js (gratis, funciona offline)
const Tesseract = require('tesseract.js');

async function processReceiptOffline(image) {
  const { data: { text } } = await Tesseract.recognize(image, 'spa');
  // Procesar con regex o GPT-4o-mini
  return parseReceiptText(text);
}
```

***

**C. Widgets y Quick Actions**

Acceso ultra-rápido desde pantalla de inicio.

**Widget iOS/Android:**
```
┌─────────────────────────────┐
│   📊 Spendly Hoy            │
│                             │
│   💰 Gastado: $340          │
│   🌍 CO2: 102kg             │
│   📈 vs ayer: +15%          │
│                             │
│   Categorías:               │
│   🚗 Transporte: $150       │
│   🍽️ Comida: $120           │
│   ☕ Café: $70              │
│                             │
│   [➕ Agregar]  [📸 Ticket]  │
└─────────────────────────────┘
```

**Quick Actions (Long press en app):**
- "Registrar gasto rápido"
- "Escanear ticket"
- "Ver resumen del día"
- "Gastos frecuentes" → Botones: Uber $150, Comida $100, Café $50

**Comandos de voz (Siri/Google Assistant):**
```
"Hey Siri, registra $80 de Uber en Spendly"
    ↓
Siri ejecuta shortcut → Spendly registra automáticamente
    ↓
Confirmación: "✅ Listo. $80 en Transporte"
```

***

#### 🔹 Nivel 3: Proactivo/Predictivo (0 input) - 5% de transacciones

**A. Sugerencias Inteligentes Basadas en Patrones**

La IA aprende rutinas y sugiere registros automáticamente.

```javascript
// Sistema de aprendizaje de patrones
const userPatterns = {
  lunches: {
    frequency: "lunes-viernes",
    time: "13:00-14:30",
    avgAmount: 85,
    location: "Cerca de UANL",
    category: "Alimentación"
  },
  uberToWork: {
    frequency: "lunes,miércoles,viernes",
    time: "07:30-08:15",
    avgAmount: 120,
    route: "Casa → Universidad"
  }
};

// Notificaciones predictivas
if (esLunes && hora === "14:00" && !hayGastoComidaHoy) {
  enviarNotificacion(
    "🍽️ ¿Comiste hoy? Normalmente gastas ~$85",
    opciones: ["$70", "$85", "$100", "No, hoy no"]
  );
}

if (esFindeMes && usuario.tieneGastosNoRegistrados) {
  enviarNotificacion(
    "📋 Fin de mes: ¿Olvidaste registrar algo?",
    sugerencias: ["Uber", "Restaurantes", "Super", "Todo bien ✅"]
  );
}
```

**Ejemplos de notificaciones proactivas:**

```
📍 Lunes 8:00am
"Detectamos que normalmente tomas Uber al trabajo los lunes (~$120).
 ¿Lo registramos?" 
 [Sí $120] [Otro monto] [Hoy no]

☕ Martes 10:30am
"Normalmente visitas Starbucks los martes (~$75).
 ¿Quieres registrarlo?"
 [Sí] [No fui hoy]

🛒 Sábado 11:00am
"Los sábados sueles ir al súper (~$450).
 Activa el modo 'Super' para escanear ticket rápido."
 [Activar] [Más tarde]

⚠️ Jueves (mitad de mes)
"Llevas $1,450 gastado. Proyección: $2,900 este mes.
 Septiembre fue $2,400. ¿Ajustamos algo?"
 [Ver detalles] [Está bien]
```

**B. Recordatorios Contextuales No Intrusivos**

```
🌙 Domingo 8:00pm (resumen semanal)
"Semana completada 🎉
 💰 Gastaste: $850
 🌍 CO2: 255kg
 📊 15% menos que semana pasada
 
 Logros:
 ✅ Usaste transporte público 3 veces
 ✅ Preparaste comida 4 días
 
 Oportunidad:
 💡 Uber te costó $240. Metro = -$180/semana"

⏰ Miércoles (3 días sin registros)
"¡Hey! Hace 3 días que no registras nada 😊
 ¿Todo tranquilo o se te pasó algo?"
 [Registrar gastos] [Todo bien]

🎯 Día 25 de mes
"Últimos días de octubre 📅
 Meta: No pasar de $2,500
 Actual: $2,180
 Disponible: $320 (10 MXN/día aprox)"
```

***

### 3. Motor de Recomendaciones con IA Contextual

Ahora las recomendaciones son **proactivas, personalizadas y accionables** en el momento justo.

#### Tipos de Recomendaciones v2.0:

**A. Alertas Inteligentes en Tiempo Real**

```
Usuario registra: $180 Uber
    ↓
Notificación instantánea:
"🚗 $180 en Uber registrado
 💡 Oportunidad de ahorro:
 
 🚇 Metro: -$165 (ahorro)
 🚲 Ecobici: -$178 (ahorro) + 60kg CO2 menos
 🚕 DiDi: -$30 (ahorro)
 
 [Ver rutas] [Ignorar]"
```

**B. Análisis Semanal Personalizado**

```
📊 Resumen Inteligente - Semana del 20 Oct

Top Insights:
1. 🚗 Transporte: $420 (35% del gasto total)
   → Transporte público hubiera ahorrado $310
   → Impacto ambiental: 168kg CO2
   
2. 🍽️ Comida fuera: $380
   → Meal prep 3 días = ahorro de $180
   → Reducción: 80kg CO2
   
3. ☕ Cafeterías: $165 (11 visitas)
   → Café casero = ahorro de $132/semana

🎯 Tu potencial de ahorro esta semana: $622
🌱 Reducción de CO2 posible: 248kg

[Activar consejos automáticos]
```

**C. Alternativas Sostenibles Contextuales**

```javascript
// IA detecta patrones problemáticos
if (usuario.gastoRestaurantes > 400 && frecuencia > 8) {
  sugerir({
    tipo: "meal-prep",
    mensaje: "💡 Plan de Ahorro: Meal Prep",
    detalles: `
      Detectamos $${total} en restaurantes este mes.
      
      Alternativa:
      🥗 Meal prep 4 días/semana
      
      Ahorro mensual: $${total * 0.6}
      Reducción CO2: ${co2 * 0.5}kg
      Tiempo de prep: 2hrs domingos
      
      [Ver recetas fáciles] [No, gracias]
    `
  });
}

if (usuario.usaUberFrecuente && !usaTransportePublico) {
  sugerir({
    tipo: "transporte-alternativo",
    mensaje: "🚇 Desafío: Semana de Transporte Público",
    detalles: `
      Esta semana, intenta usar transporte público
      3 de 5 días laborales.
      
      Ahorro proyectado: $240
      CO2 evitado: 90kg
      
      Recompensa: Badge 🏆 "Eco-Commuter"
      
      [Aceptar desafío] [Tal vez después]
    `
  });
}
```

**D. Gamificación Inteligente**

```
🏆 Logros Desbloqueados:

✅ "Eco-Warrior" (Nivel 2)
   → Reduciste 120kg CO2 este mes

✅ "Ahorro Ninja"
   → Gastaste 25% menos en transporte

🔒 Próximo objetivo:
   "Meal Prep Master"
   → Cocina en casa 15 días este mes
   Progreso: 8/15 días ⬛⬛⬛⬜⬜

💎 Puntos acumulados: 1,240
   Canjea por: Descuentos en apps eco-friendly
```

***

### 4. Módulo de Movilidad Eficiente (Enfoque Transporte)

Mejorado con comparaciones en tiempo real y sugerencias proactivas.

#### Features Nuevos:

**A. Comparador de Rutas en Tiempo Real**

```
Usuario abre app antes de salir:
"¿A dónde vas?" → Selecciona destino frecuente

┌─────────────────────────────────────┐
│  🏠 Casa → 🎓 UANL (8.5km)         │
├─────────────────────────────────────┤
│  🚗 Uber                            │
│  💰 $135  ⏱️ 18min  🌍 54kg CO2     │
│  [Pedir Uber]                       │
├─────────────────────────────────────┤
│  🚕 DiDi                            │
│  💰 $110  ⏱️ 20min  🌍 44kg CO2     │
│  Ahorro: $25 | -10kg CO2            │
│  [Pedir DiDi]                       │
├─────────────────────────────────────┤
│  🚇 Transporte Público              │
│  💰 $10   ⏱️ 35min  🌍 2kg CO2      │
│  Ahorro: $125 | -52kg CO2 ⭐        │
│  [Ver rutas]                        │
├─────────────────────────────────────┤
│  🚲 Ecobici                         │
│  💰 $5    ⏱️ 25min  🌍 0kg CO2      │
│  Ahorro: $130 | -54kg CO2 🏆        │
│  Bonus: Ejercicio 🏃               │
│  [Ver estaciones]                   │
└─────────────────────────────────────┘
```

**B. Análisis de Patrones de Movilidad**

```
📊 Tu Movilidad - Octubre

Distribución:
🚗 Uber/DiDi: 65% ($890)
🚇 Transporte público: 20% ($120)
🚲 Bici/Caminando: 10% ($20)
🚕 Taxi tradicional: 5% ($40)

Rutas más frecuentes:
1. Casa → UANL (18 viajes) - $2,160 en Uber
   Alternativa: Transporte público = ahorro de $1,980

2. UANL → Centro (8 viajes) - $480 en Uber
   Alternativa: Metrobús = ahorro de $400

💡 Potencial de ahorro mensual: $2,380
🌱 Reducción CO2 posible: 890kg

[Activar sugerencias de ruta]
```

**C. Modo "Smart Commute"**

```javascript
// Usuario activa modo inteligente para viajes frecuentes
const smartCommuteMode = {
  enabled: true,
  rutasTrabajo: ["Casa → UANL", "UANL → Casa"],
  preferencia: "ahorro", // o "tiempo" o "balance"
  horarios: ["7:00-9:00am", "5:00-7:00pm"]
};

// Notificación proactiva
if (hora === "7:15am" && ubicacion === "casa") {
  notificar(`
    🚇 Hora de ir a la uni!
    
    Recomendación inteligente:
    Transporte público sale en 8 minutos
    Tiempo: 32min | Costo: $10 | CO2: 2kg
    
    vs
    
    Uber: 18min | $135 | 54kg CO2
    
    Ahorro hoy: $125 💰
    
    [Ver ruta] [Pedir Uber de todos modos]
  `);
}
```

***

### 5. Historial y Análisis de Tendencias Automático

Todo se actualiza en tiempo real sin necesidad de generar reportes manualmente.

#### Features Nuevos:

**A. Timeline Inteligente**

```
📅 Octubre 2025

▼ Semana 4 (21-27 Oct) - $850
  ├─ Lun 21: $180 (🚗 Uber, 🍽️ Comida)
  ├─ Mar 22: $120 (☕ Café, 🛒 Super)
  ├─ Mié 23: $150 (🍕 Cena, 🎬 Cine)
  ├─ Jue 24: $200 (🚗 Uber x2, ☕ Starbucks)
  ├─ Vie 25: $200 (🍻 Salida con amigos)
  
  💡 Insights:
  - Uber: 4 viajes = $280 (⚠️ +40% vs semana pasada)
  - Comida fuera: $350 (🔴 Límite semanal excedido)

▼ Semana 3 (14-20 Oct) - $720
  ...
  
  ✅ Logros:
  - Transporte público: 3 días
  - Meal prep: 4 días
```

**B. Gráficas Predictivas**

```javascript
// Dashboard muestra proyección automática
const proyeccionMes = {
  diasTranscurridos: 25,
  diasRestantes: 6,
  gastoActual: 2340,
  promedioD iario: 93.6,
  proyeccion: 2900,
  presupuesto: 2500,
  alerta: true, // Excede presupuesto
  ajusteNecesario: "Reducir $67/día para cumplir meta"
};

// Visualización
📊 Proyección Octubre

Meta: $2,500 ━━━━━━━━━━━━━━━━━ 100%
Actual: $2,340 ━━━━━━━━━━━━━━⬜⬜ 94%
Proyección: $2,900 ━━━━━━━━━━━━━━━━━━⚠️ 116%

⚠️ Riesgo de exceder presupuesto en $400

Para cumplir meta:
🎯 Gasto máximo restante: $160
📊 $26/día los próximos 6 días

[Ver recomendaciones de ajuste]
```

**C. Comparativas Automáticas**

```
📈 Comparativa: Octubre vs Septiembre

                Oct     Sep     Cambio
💰 Total        $2,340  $2,750  -15% ✅
🚗 Transporte   $890    $650    +37% ⚠️
🍽️ Comida       $670    $820    -18% ✅
🎬 Entretenimiento $450 $580    -22% ✅
🏠 Hogar        $330    $700    -53% ✅

🌍 Huella CO2:
   Oct: 780kg | Sep: 920kg | -15% ✅

Top mejora:
✅ Hogar: -$370 (pagas bimestrales)
✅ Comida: -$150 (más meal prep)

Área de atención:
⚠️ Transporte: +$240 (más uso de Uber)
💡 Sugerencia: Regresar a transporte público
   Ahorro potencial: $220/mes
```

***

## Características "Wow" para Destacar en el Hackathon

### 🏆 Feature Prioritario 1: Recopilación Invisible

**Demo en vivo:**
1. Mostrar dashboard con 0 transacciones
2. "Conectar" banco (simulado) → Botón "Sincronizar"
3. Animación de carga 2-3 segundos
4. Dashboard se llena con 30+ transacciones automáticamente
5. Todas categorizadas y con huella de carbono calculada

**Impacto visual:**
- Gráficas que se construyen en tiempo real
- Contador de CO2 que sube dinámicamente
- Notificación: "✅ 32 transacciones importadas | 0 minutos de tu tiempo"

---

### 🏆 Feature Prioritario 2: WhatsApp Bot en Vivo

**Demo interactivo durante pitch:**
1. Proyectar chat de WhatsApp en pantalla grande
2. Juez/audiencia envía mensaje: "150 pesos uber"
3. Bot responde en <2 segundos con categorización y consejo
4. Dashboard en otra pantalla se actualiza en tiempo real
5. Mostrar cómo funciona con lenguaje natural variado

**Frases para probar en vivo:**
- "pagué 80 de comida"
- "starbucks 65"
- "¿cuánto llevo?"
- "consejo para ahorrar"

***

### 🏆 Feature Prioritario 3: Recomendación IA Contextual

**Escenario de demo:**
```
Usuario registra: $200 Uber (mediante WhatsApp o manual)
    ↓
Pantalla muestra notificación inmediata:
┌──────────────────────────────────────┐
│ 💡 Oportunidad de Ahorro Inteligente │
│                                      │
│ Acabas de gastar $200 en Uber       │
│                                      │
│ Alternativas para esta ruta:         │
│                                      │
│ 🚇 Transporte Público                │
│ Ahorro: $185 | CO2: -78kg           │
│ Tiempo: +15 min                      │
│                                      │
│ 🚕 DiDi                              │
│ Ahorro: $40 | CO2: -15kg            │
│ Tiempo: igual                        │
│                                      │
│ Esta semana en Uber: $520           │
│ Podrías haber ahorrado: $410 💰     │
│                                      │
│ [Ver plan de movilidad inteligente]  │
└──────────────────────────────────────┘
```

***

### 🏆 Feature Bonus 1: OCR de Tickets en Segundos

**Demo:**
1. Mostrar ticket físico de tacos/restaurante
2. Tomar foto desde la app
3. Procesamiento visual con loading elegante
4. En 3 segundos: monto, comercio, categoría extraídos
5. Usuario solo toca "Confirmar"

***

### 🏆 Feature Bonus 2: Dashboard de Doble Impacto

**Visualización simultánea:**
```
┌─────────────────┬─────────────────┐
│ 💰 Financiero   │ 🌍 Ambiental    │
├─────────────────┼─────────────────┤
│ Gasto: $2,340   │ CO2: 780kg      │
│                 │                 │
│ [Gráfica $$$]   │ [Gráfica CO2]   │
│                 │                 │
│ Top categorías: │ Top emisiones:  │
│ 1. Transporte   │ 1. Transporte   │
│ 2. Comida       │ 2. Comida       │
│ 3. Entret.      │ 3. Compras      │
└─────────────────┴─────────────────┘

Equivalencia ambiental:
🌳 780kg CO2 = Plantar 35 árboles
🚗 = 3,200 km en coche
⚡ = 2,600 kWh de energía
```

***

## Arquitectura Técnica del MVP v2.0

### Frontend
```javascript
// Stack moderno y rápido
Framework: Next.js 14 (App Router) con React
UI: Tailwind CSS + Shadcn/ui + Framer Motion (animaciones)
Charts: Recharts o Chart.js
Estado Global: Zustand (más ligero que Redux)
Notificaciones: React-Hot-Toast
PWA: next-pwa (funciona offline)

// Estructura de carpetas
/app
  /dashboard
  /transactions
  /insights
  /settings
/components
  /ui (shadcn components)
  /features
    /TransactionForm
    /Dashboard
    /OCRScanner
/lib
  /api (llamadas al backend)
  /utils (helpers)
  /ai (funciones de IA)
```

### Backend (Opción Completa para Hackathon)

```javascript
// API REST con Node.js
Framework: Express.js + TypeScript
Base de datos: Supabase (PostgreSQL) o MongoDB Atlas
Autenticación: Supabase Auth o Clerk
Real-time: Supabase Realtime o Socket.io

// Endpoints principales
POST   /api/transactions              // Crear transacción
GET    /api/transactions              // Listar transacciones
GET    /api/insights                  // Análisis y recomendaciones
POST   /api/sync-bank                 // Sincronizar banco (mock)
POST   /api/ocr-scan                  // Procesar ticket OCR
POST   /api/webhook/whatsapp          // Recibir mensaje WhatsApp

// Estructura
/src
  /routes
    /transactions.ts
    /insights.ts
    /whatsapp.ts
  /controllers
  /services
    /ai.service.ts
    /bank.service.ts
    /carbon.service.ts
  /models
  /utils
```

### Servicios de IA/ML

```javascript
// OpenAI API para NLP y recomendaciones
import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});

// Categorización automática
async function categorizeTransaction(description: string) {
  const response = await openai.chat.completions.create({
    model: "gpt-4o-mini", // Más barato y rápido
    messages: [{
      role: "system",
      content: `Eres un experto en categorización de gastos.
      Categorías: Transporte, Alimentación, Entretenimiento, 
      Servicios, Compras, Hogar, Salud, Educación.
      
      Responde en JSON:
      {
        "category": "categoría",
        "subcategory": "subcategoría específica",
        "confidence": 0-1
      }`
    }, {
      role: "user",
      content: `Categoriza: "${description}"`
    }],
    response_format: { type: "json_object" }
  });
  
  return JSON.parse(response.choices[0].message.content);
}

// Generar recomendaciones personalizadas
async function generateAdvice(userData: UserData) {
  const prompt = `
    Usuario ha gastado este mes:
    - Transporte: $${userData.transport} (${userData.transportTrips} viajes)
    - Alimentación: $${userData.food}
    - Total: $${userData.total}
    
    Patrones:
    - Usa Uber ${userData.uberFrequency}x/semana
    - Come fuera ${userData.eatingOut}x/semana
    
    Genera 3 consejos accionables y específicos para:
    1. Ahorrar dinero
    2. Reducir huella de carbono
    3. Mejorar hábitos financieros
    
    Formato JSON:
    {
      "tips": [
        {
          "title": "...",
          "description": "...",
          "impact": "ahorro estimado",
          "co2Reduction": "kg CO2"
        }
      ]
    }
  `;
  
  const response = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    messages: [{ role: "user", content: prompt }],
    response_format: { type: "json_object" }
  });
  
  return JSON.parse(response.choices[0].message.content);
}
```

### WhatsApp Bot (Twilio)

```javascript
// Webhook para recibir mensajes
import twilio from 'twilio';

const twilioClient = twilio(
  process.env.TWILIO_ACCOUNT_SID,
  process.env.TWILIO_AUTH_TOKEN
);

app.post('/api/webhook/whatsapp', async (req, res) => {
  const { Body, From } = req.body;
  const userPhone = From;
  const message = Body;
  
  // 1. Identificar usuario por teléfono
  const user = await getUserByPhone(userPhone);
  
  // 2. Procesar mensaje con IA
  const intent = await detectIntent(message);
  
  if (intent.type === 'expense') {
    // Registrar gasto
    const transaction = await createTransaction({
      userId: user.id,
      amount: intent.amount,
      category: intent.category,
      description: intent.description,
      date: new Date()
    });
    
    // Calcular CO2
    const co2 = calculateCO2(intent.amount, intent.category);
    
    // Generar consejo
    const advice = await generateQuickAdvice(user, transaction);
    
    // Responder por WhatsApp
    const response = `
✅ Registrado: $${intent.amount} MXN | ${intent.category} | ${co2}kg CO2

${advice}

📊 Gasto hoy: $${await getTodayTotal(user.id)}
    `.trim();
    
    await twilioClient.messages.create({
      body: response,
      from: 'whatsapp:+14155238886', // Número de Twilio
      to: userPhone
    });
    
  } else if (intent.type === 'query') {
    // Usuario pregunta "cuánto llevo?"
    const summary = await getMonthSummary(user.id);
    const response = formatSummary(summary);
    
    await twilioClient.messages.create({
      body: response,
      from: 'whatsapp:+14155238886',
      to: userPhone
    });
  }
  
  res.sendStatus(200);
});

// Detectar intención con GPT
async function detectIntent(message: string) {
  const response = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    messages: [{
      role: "system",
      content: `Analiza el mensaje y determina si es:
      1. "expense": Usuario reporta un gasto
      2. "query": Usuario hace una pregunta
      
      Si es expense, extrae: amount, description, category
      Si es query, determina: queryType (summary, advice, etc)
      
      Responde JSON.`
    }, {
      role: "user",
      content: message
    }],
    response_format: { type: "json_object" }
  });
  
  return JSON.parse(response.choices[0].message.content);
}
```

### OCR Service

```javascript
// Google Cloud Vision para OCR
import vision from '@google-cloud/vision';

const visionClient = new vision.ImageAnnotatorClient({
  keyFilename: './google-cloud-key.json'
});

async function scanReceipt(imageBase64: string) {
  // 1. Extraer texto del ticket
  const [result] = await visionClient.textDetection({
    image: { content: imageBase64 }
  });
  
  const fullText = result.fullTextAnnotation?.text || '';
  
  // 2. Estructurar con GPT
  const response = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    messages: [{ role: "user", content: `
      Analiza este ticket de compra y extrae:
      - Fecha
      - Comprador
      - Productos (nombre, cantidad, precio unitario)
      - Total
      
      Ticket: ${fullText}
      
      Formato JSON:
      {
        "date": "YYYY-MM-DD",
        "buyer": "Nombre Completo",
        "items": [
          {
            "name": "Producto A",
            "quantity": 2,
            "unitPrice": 50.00
          }
        ],
        "total": 100.00
      }
    `}],
    response_format: { type: "json_object" }
  });
  
  return JSON.parse(response.choices[0].message.content);
}
```

```javascript
  // 2. Estructurar con GPT-4 Vision
  const structured = await openai.chat.completions.create({
    model: "gpt-4-vision-preview",
    messages: [{
      role: "user",
      content: [
        {
          type: "text",
          text: `Analiza este ticket y extrae:
          - Total (monto final)
          - Comercio/Restaurante
          - Fecha
          - Items comprados (opcional)
          - Tipo de establecimiento
          
          Responde en JSON:
          {
            "total": number,
            "merchant": string,
            "date": "YYYY-MM-DD",
            "items": [string],
            "type": "restaurant|grocery|retail|service"
          }`
        },
        {
          type: "image_url",
          image_url: {
            url: `data:image/jpeg;base64,${imageBase64}`
          }
        }
      ]
    }],
    response_format: { type: "json_object" }
  });
  
  const receiptData = JSON.parse(structured.choices[0].message.content);
  
  // 3. Categorizar automáticamente
  const category = await categorizeByMerchant(
    receiptData.merchant, 
    receiptData.type
  );
  
  return {
    ...receiptData,
    category,
    co2: calculateCO2(receiptData.total, category)
  };
}

// Alternativa: Tesseract.js (gratis, local)
import Tesseract from 'tesseract.js';

async function scanReceiptOffline(imageBuffer: Buffer) {
  const { data: { text } } = await Tesseract.recognize(
    imageBuffer,
    'spa', // español
    {
      logger: m => console.log(m) // progress
    }
  );
  
  // Procesar texto con GPT-4o-mini
  const structured = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    messages: [{
      role: "system",
      content: "Extrae total, comercio y fecha del texto de un ticket."
    }, {
      role: "user",
      content: text
    }],
    response_format: { type: "json_object" }
  });
  
  return JSON.parse(structured.choices[0].message.content);
}
```

### Integración Bancaria (Simulada para Hackathon)

```javascript
// Mock de Plaid/Belvo API
class BankingService {
  // Simular conexión bancaria
  async connectBank(userId: string, bankCredentials: any) {
    // En producción: Plaid.createLinkToken()
    // Para demo: Retornar mock
    
    return {
      linkToken: 'mock_link_token_123',
      institutionId: 'banorte_mx',
      status: 'connected'
    };
  }
  
  // Simular sincronización de transacciones
  async syncTransactions(userId: string, bankId: string) {
    // Mock de transacciones realistas
    const mockTransactions = [
      {
        id: 'tx_001',
        date: '2025-10-24',
        amount: -150.00,
        merchant: 'UBER *TRIP',
        description: 'UBER *TRIP HELP.UBER.COM',
        category: null, // Para categorizar con IA
        pending: false
      },
      {
        id: 'tx_002',
        date: '2025-10-24',
        amount: -85.50,
        merchant: 'OXXO',
        description: 'OXXO #3421 MONTERREY',
        category: null,
        pending: false
      },
      {
        id: 'tx_003',
        date: '2025-10-23',
        amount: -320.00,
        merchant: 'HEB',
        description: 'HEB SAN PEDRO MONTERREY',
        category: null,
        pending: false
      },
      {
        id: 'tx_004',
        date: '2025-10-23',
        amount: -65.00,
        merchant: 'STARBUCKS',
        description: 'STARBUCKS VALLE ORIENTE',
        category: null,
        pending: false
      },
      {
        id: 'tx_005',
        date: '2025-10-22',
        amount: -199.00,
        merchant: 'NETFLIX',
        description: 'NETFLIX.COM',
        category: null,
        pending: false
      }
      // ... más transacciones
    ];
    
    // Procesar cada transacción
    const processedTransactions = [];
    
    for (const tx of mockTransactions) {
      // Categorizar con IA
      const category = await this.categorizeTransaction(tx.description);
      
      // Calcular CO2
      const co2 = calculateCO2(Math.abs(tx.amount), category.category);
      
      // Guardar en DB
      const saved = await db.transactions.create({
        userId,
        bankTransactionId: tx.id,
        date: tx.date,
        amount: Math.abs(tx.amount),
        merchant: tx.merchant,
        description: tx.description,
        category: category.category,
        subcategory: category.subcategory,
        co2Impact: co2,
        source: 'bank_sync'
      });
      
      processedTransactions.push(saved);
    }
    
    // Generar notificación
    await this.notifyUserOfSync(userId, processedTransactions.length);
    
    return {
      synced: processedTransactions.length,
      transactions: processedTransactions
    };
  }
  
  async categorizeTransaction(description: string) {
    // Usar IA para categorizar
    const response = await openai.chat.completions.create({
      model: "gpt-4o-mini",
      messages: [{
        role: "system",
        content: `Categoriza transacciones bancarias.
        
        Categorías disponibles:
        - Transporte (Uber, DiDi, Gasolina, Estacionamiento)
        - Alimentación (Restaurantes, Supermercado, Cafeterías)
        - Entretenimiento (Cine, Streaming, Eventos)
        - Servicios (Internet, Teléfono, Luz, Agua)
        - Compras (Ropa, Electrónica, Amazon)
        - Hogar (Muebles, Decoración, Mantenimiento)
        - Salud (Farmacia, Doctor, Gym)
        - Educación (Cursos, Libros, Universidad)
        
        Responde JSON: {"category": "...", "subcategory": "...", "confidence": 0.0-1.0}`
      }, {
        role: "user",
        content: `Categoriza: "${description}"`
      }],
      response_format: { type: "json_object" }
    });
    
    return JSON.parse(response.choices[0].message.content);
  }
  
  async notifyUserOfSync(userId: string, count: number) {
    // Enviar notificación push
    await sendPushNotification(userId, {
      title: '✅ Sincronización Completa',
      body: `${count} transacciones importadas y categorizadas`,
      data: { type: 'bank_sync', count }
    });
  }
}
```

### Cálculo de Huella de Carbono

```javascript
// Carbon Footprint Calculator
class CarbonCalculator {
  // Factores de emisión por categoría (kg CO2 por $1 MXN gastado)
  private emissionFactors = {
    'Transporte': {
      'Uber/DiDi': 0.4,      // Alto
      'Taxi': 0.4,
      'Gasolina': 0.5,       // Muy alto
      'Transporte Público': 0.05,  // Muy bajo
      'Bicicleta': 0,
      'Caminando': 0
    },
    'Alimentación': {
      'Restaurante': 0.3,    // Medio-alto
      'Fast Food': 0.35,
      'Supermercado': 0.15,  // Medio
      'Cafetería': 0.25,
      'Delivery': 0.32
    },
    'Entretenimiento': {
      'Cine': 0.1,
      'Streaming': 0.02,     // Muy bajo
      'Eventos': 0.15
    },
    'Servicios': {
      'Internet': 0.02,
      'Electricidad': 0.4,
      'Agua': 0.1,
      'Teléfono': 0.02
    },
    'Compras': {
      'Ropa (Fast Fashion)': 0.4,  // Alto
      'Ropa (Segunda Mano)': 0.1,
      'Electrónica': 0.5,    // Muy alto
      'General': 0.2
    },
    'Hogar': {
      'Muebles Nuevos': 0.35,
      'Segunda Mano': 0.1,
      'Mantenimiento': 0.15
    },
    'Salud': {
      'Farmacia': 0.15,
      'Consulta': 0.1
    },
    'Educación': {
      'Libros Físicos': 0.2,
      'Digital': 0.02
    }
  };
  
  calculate(amount: number, category: string, subcategory?: string): number {
    // Obtener factor de emisión
    let factor = 0.2; // Factor default
    
    if (this.emissionFactors[category]) {
      if (subcategory && this.emissionFactors[category][subcategory]) {
        factor = this.emissionFactors[category][subcategory];
      } else {
        // Usar promedio de la categoría
        const factors = Object.values(this.emissionFactors[category]);
        factor = factors.reduce((a, b) => a + b, 0) / factors.length;
      }
    }
    
    // Calcular CO2 en kg
    const co2 = amount * factor;
    
    return Math.round(co2 * 100) / 100; // Redondear a 2 decimales
  }
  
  // Calcular equivalencias tangibles
  getEquivalences(totalCO2: number) {
    return {
      trees: Math.round(totalCO2 / 22), // 1 árbol absorbe ~22kg CO2/año
      carKm: Math.round(totalCO2 / 0.244), // Auto promedio: 0.244kg CO2/km
      electricity: Math.round(totalCO2 / 0.3), // 1 kWh ≈ 0.3kg CO2
      flights: Math.round(totalCO2 / 90) // Vuelo corto ≈ 90kg CO2
    };
  }
  
  // Comparar con promedio nacional
  compareToAverage(userCO2: number, period: 'monthly' | 'yearly'): string {
    // Promedio mexicano: ~4,000 kg CO2/año per cápita
    const avgYearly = 4000;
    const avgMonthly = avgYearly / 12;
    
    const average = period === 'monthly' ? avgMonthly : avgYearly;
    const percentDiff = ((userCO2 - average) / average) * 100;
    
    if (percentDiff < -20) {
      return `🌟 Excelente! ${Math.abs(Math.round(percentDiff))}% por debajo del promedio`;
    } else if (percentDiff < 0) {
      return `✅ Bien! ${Math.abs(Math.round(percentDiff))}% por debajo del promedio`;
    } else if (percentDiff < 20) {
      return `⚠️ ${Math.round(percentDiff)}% por encima del promedio`;
    } else {
      return `🔴 ${Math.round(percentDiff)}% por encima del promedio`;
    }
  }
}

// Usar el calculador
const carbonCalc = new CarbonCalculator();

// Ejemplo
const uberCO2 = carbonCalc.calculate(150, 'Transporte', 'Uber/DiDi');
// Resultado: 60kg CO2

const totalCO2 = 780; // CO2 del mes
const equivalences = carbonCalc.getEquivalences(totalCO2);
/*
{
  trees: 35,
  carKm: 3197,
  electricity: 2600,
  flights: 8
}
*/
```

### Sistema de Notificaciones Inteligentes

```javascript
// Notification Service con lógica contextual
class SmartNotificationService {
  // Análisis de patrones para notificaciones proactivas
  async analyzeAndNotify(userId: string) {
    const user = await db.users.findById(userId);
    const transactions = await db.transactions.findByUser(userId);
    
    // Detectar patrones
    const patterns = this.detectPatterns(transactions);
    
    // Generar notificaciones contextuales
    const notifications = [];
    
    // 1. Gasto inusual
    if (patterns.unusualSpending) {
      notifications.push({
        type: 'alert',
        priority: 'high',
        title: '⚠️ Gasto Inusual Detectado',
        body: `${patterns.unusualSpending.category}: $${patterns.unusualSpending.amount} (${patterns.unusualSpending.percentAbove}% más que lo normal)`,
        action: 'view_details'
      });
    }
    
    // 2. Sugerencia de transporte
    if (patterns.highTransportCost && !patterns.usesPublicTransport) {
      notifications.push({
        type: 'suggestion',
        priority: 'medium',
        title: '🚇 Oportunidad de Ahorro en Transporte',
        body: `Gastaste $${patterns.transportTotal} este mes. Transporte público podría ahorrarte $${patterns.potentialSavings}`,
        action: 'view_transport_alternatives'
      });
    }
    
    // 3. Meta de presupuesto en riesgo
    if (patterns.budgetRisk) {
      const daysLeft = this.getDaysLeftInMonth();
      const dailyLimit = patterns.remaining / daysLeft;
      
      notifications.push({
        type: 'warning',
        priority: 'high',
        title: '🎯 Meta en Riesgo',
        body: `Te quedan $${patterns.remaining} para ${daysLeft} días. Límite: $${Math.round(dailyLimit)}/día`,
        action: 'adjust_budget'
      });
    }
    
    // 4. Logro desbloqueado
    if (patterns.achievement) {
      notifications.push({
        type: 'achievement',
        priority: 'low',
        title: `🏆 ${patterns.achievement.title}`,
        body: patterns.achievement.description,
        action: 'view_achievements'
      });
    }
    
    // 5. Recordatorio de registro
    const daysSinceLastEntry = this.getDaysSinceLastManualEntry(userId);
    if (daysSinceLastEntry >= 3) {
      notifications.push({
        type: 'reminder',
        priority: 'low',
        title: '📝 Recordatorio Amigable',
        body: `Hace ${daysSinceLastEntry} días que no registras gastos en efectivo. ¿Olvidaste algo?`,
        action: 'add_expense'
      });
    }
    
    // Enviar notificaciones
    for (const notif of notifications) {
      await this.send(userId, notif);
    }
    
    return notifications;
  }
  
  detectPatterns(transactions: Transaction[]) {
    // Implementar detección de patrones
    const thisMonth = transactions.filter(t => this.isThisMonth(t.date));
    const lastMonth = transactions.filter(t => this.isLastMonth(t.date));
    
    // Calcular promedios
    const avgThisMonth = this.average(thisMonth.map(t => t.amount));
    const avgLastMonth = this.average(lastMonth.map(t => t.amount));
    
    // Detectar gastos inusuales (>50% más que promedio)
    const unusualSpending = thisMonth.find(t => 
      t.amount > avgThisMonth * 1.5
    );
    
    // Detectar alto costo de transporte
    const transportTransactions = thisMonth.filter(t => 
      t.category === 'Transporte'
    );
    const transportTotal = this.sum(transportTransactions.map(t => t.amount));
    const highTransportCost = transportTotal > 500; // Umbral
    
    return {
      unusualSpending: unusualSpending ? {
        category: unusualSpending.category,
        amount: unusualSpending.amount,
        percentAbove: Math.round(((unusualSpending.amount - avgThisMonth) / avgThisMonth) * 100)
      } : null,
      highTransportCost,
      transportTotal,
      potentialSavings: transportTotal * 0.7, // 70% de ahorro estimado con transporte público
      usesPublicTransport: transportTransactions.some(t => 
        t.subcategory === 'Transporte Público'
      ),
      budgetRisk: null, // Implementar lógica de presupuesto
      achievement: null // Implementar lógica de logros
    };
  }
  
  async send(userId: string, notification: any) {
    // Implementar con Firebase Cloud Messaging, OneSignal, etc.
    // O notificaciones in-app
    await db.notifications.create({
      userId,
      ...notification,
      createdAt: new Date(),
      read: false
    });
    
    // Enviar push notification si usuario tiene device token
    const userDevices = await db.devices.findByUser(userId);
    for (const device of userDevices) {
      await this.sendPush(device.token, notification);
    }
  }
}
```

### Sistema de Aprendizaje de Patrones

```javascript
// Machine Learning Light - Pattern Recognition
class PatternLearningService {
  // Aprender rutinas del usuario
  async learnUserPatterns(userId: string) {
    const transactions = await db.transactions.findByUser(userId, {
      limit: 1000, // Últimas 1000 transacciones
      orderBy: 'date DESC'
    });
    
    // Analizar patrones temporales
    const temporalPatterns = this.analyzeTemporalPatterns(transactions);
    
    // Analizar patrones de ubicación (si disponible)
    const locationPatterns = this.analyzeLocationPatterns(transactions);
    
    // Analizar patrones de gasto
    const spendingPatterns = this.analyzeSpendingPatterns(transactions);
    
    // Guardar patrones aprendidos
    await db.userPatterns.upsert({
      userId,
      temporal: temporalPatterns,
      location: locationPatterns,
      spending: spendingPatterns,
      lastUpdated: new Date()
    });
    
    return {
      temporal: temporalPatterns,
      location: locationPatterns,
      spending: spendingPatterns
    };
  }
  
  analyzeTemporalPatterns(transactions: Transaction[]) {
    const patterns = {
      weekly: {},  // Día de la semana
      daily: {},   // Hora del día
      monthly: {}  // Día del mes
    };
    
    for (const tx of transactions) {
      const date = new Date(tx.date);
      const dayOfWeek = date.toLocaleDateString('es-MX', { weekday: 'long' });
      const hour = date.getHours();
      const dayOfMonth = date.getDate();
      
      // Patrones semanales
      if (!patterns.weekly[dayOfWeek]) {
        patterns.weekly[dayOfWeek] = [];
      }
      patterns.weekly[dayOfWeek].push({
        category: tx.category,
        amount: tx.amount,
        merchant: tx.merchant
      });
      
      // Patrones diarios
      const timeSlot = this.getTimeSlot(hour);
      if (!patterns.daily[timeSlot]) {
        patterns.daily[timeSlot] = [];
      }
      patterns.daily[timeSlot].push({
        category: tx.category,
        amount: tx.amount
      });
    }
    
    // Encontrar patrones recurrentes
    const recurring = {
      lunches: this.findRecurringLunches(patterns),
      commutes: this.findRecurringCommutes(patterns),
      subscriptions: this.findSubscriptions(transactions)
    };
    
    return {
      patterns,
      recurring
    };
  }
  
  findRecurringLunches(patterns: any) {
    // Detectar si usuario come fuera regularmente
    const lunchHours = ['12:00-14:00', '14:00-16:00'];
    const lunchTransactions = [];
    
    for (const slot of lunchHours) {
      if (patterns.daily[slot]) {
        const foodTx = patterns.daily[slot].filter(t => 
          t.category === 'Alimentación'
        );
        lunchTransactions.push(...foodTx);
      }
    }
    
    if (lunchTransactions.length >= 8) { // Al menos 8 comidas/mes
      const avgAmount = lunchTransactions.reduce((sum, t) => sum + t.amount, 0) / lunchTransactions.length;
      
      return {
        detected: true,
        frequency: `${lunchTransactions.length} veces/mes`,
        avgAmount: Math.round(avgAmount),
        estimatedMonthly: Math.round(avgAmount * 20), // 20 días laborales
        days: ['lunes', 'martes', 'miércoles', 'jueves', 'viernes']
      };
    }
    
    return { detected: false };
  }
  
  findRecurringCommutes(patterns: any) {
    // Detectar traslados regulares al trabajo/escuela
    const morningCommutes = patterns.daily['07:00-09:00']?.filter(t =>
      t.category === 'Transporte'
    ) || [];
    
    const eveningCommutes = patterns.daily['17:00-19:00']?.filter(t =>
      t.category === 'Transporte'
    ) || [];
    
    if (morningCommutes.length >= 8 || eveningCommutes.length >= 8) {
      const allCommutes = [...morningCommutes, ...eveningCommutes];
      const avgAmount = allCommutes.reduce((sum, t) => sum + t.amount, 0) / allCommutes.length;
      
      return {
        detected: true,
        frequency: `${allCommutes.length} veces/mes`,
        avgAmount: Math.round(avgAmount),
        estimatedMonthly: Math.round(avgAmount * 40), // Ida y vuelta 20 días
        peakHours: ['07:00-09:00', '17:00-19:00']
      };
    }
    
    return { detected: false };
  }
  
  findSubscriptions(transactions: Transaction[]) {
    // Detectar pagos recurrentes (Netflix, Spotify, etc.)
    const merchantCounts = {};
    
    for (const tx of transactions) {
      if (!merchantCounts[tx.merchant]) {
        merchantCounts[tx.merchant] = [];
      }
      merchantCounts[tx.merchant].push(tx);
    }
    
    const subscriptions = [];
    
    for (const [merchant, txs] of Object.entries(merchantCounts)) {
      if (txs.length >= 3) { // Al menos 3 pagos
        const amounts = txs.map(t => t.amount);
        const isRecurring = this.areAmountsSimilar(amounts);
        
        if (isRecurring) {
          subscriptions.push({
            merchant,
            amount: amounts[0],
            frequency: this.detectFrequency(txs),
            lastCharge: txs[0].date
          });
        }
      }
    }
    
    return subscriptions;
  }
  
  getTimeSlot(hour: number): string {
    if (hour >= 6 && hour < 9) return '06:00-09:00';
    if (hour >= 9 && hour < 12) return '09:00-12:00';
    if (hour >= 12 && hour < 14) return '12:00-14:00';
    if (hour >= 14 && hour < 17) return '14:00-17:00';
    if (hour >= 17 && hour < 20) return '17:00-20:00';
    if (hour >= 20 && hour < 23) return '20:00-23:00';
    return '23:00-06:00';
  }
  
  areAmountsSimilar(amounts: number[]): boolean {
    if (amounts.length < 2) return false;
    
    const avg = amounts.reduce((a, b) => a + b, 0) / amounts.length;
    const variance = amounts.reduce((sum, amount) => 
      sum + Math.pow(amount - avg, 2), 0
    ) / amounts.length;
    
    const stdDev = Math.sqrt(variance);
    
    // Si la desviación estándar es menos del 5% del promedio, son similares
    return (stdDev / avg) < 0.05;
  }
  
  detectFrequency(transactions: Transaction[]): string {
    // Detectar si es mensual, semanal, etc.
    if (transactions.length < 2) return 'unknown';
    
    const sortedTx = transactions.sort((a, b) => 
      new Date(a.date).getTime() - new Date(b.date).getTime()
    );
    
    const intervals = [];
    for (let i = 1; i < sortedTx.length; i++) {
      const days = this.daysBetween(sortedTx[i-1].date, sortedTx[i].date);
      intervals.push(days);
    }
    
    const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
    
    if (avgInterval >= 28 && avgInterval <= 32) return 'mensual';
    if (avgInterval >= 6 && avgInterval <= 8) return 'semanal';
    if (avgInterval >= 13 && avgInterval <= 15) return 'quincenal';
    if (avgInterval >= 88 && avgInterval <= 95) return 'trimestral';
    if (avgInterval >= 358 && avgInterval <= 372) return 'anual';
    
    return `cada ${Math.round(avgInterval)} días`;
  }
  
  daysBetween(date1: string, date2: string): number {
    const d1 = new Date(date1).getTime();
    const d2 = new Date(date2).getTime();
    return Math.abs(d2 - d1) / (1000 * 60 * 60 * 24);
  }
}
```

***

## Integración con Base de Datos

### Schema de Supabase/PostgreSQL

```sql
-- Tabla de usuarios
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  phone VARCHAR(20) UNIQUE,
  name VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  -- Configuraciones
  budget_monthly DECIMAL(10,2) DEFAULT 2500.00,
  currency VARCHAR(3) DEFAULT 'MXN',
  notifications_enabled BOOLEAN DEFAULT true,
  whatsapp_connected BOOLEAN DEFAULT false,
  bank_connected BOOLEAN DEFAULT false
);

-- Tabla de transacciones
CREATE TABLE transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  amount DECIMAL(10,2) NOT NULL,
  merchant VARCHAR(255),
  description TEXT,
  category VARCHAR(100) NOT NULL,
  subcategory VARCHAR(100),
  co2_impact DECIMAL(10,2), -- kg de CO2
  date TIMESTAMP NOT NULL,
  source VARCHAR(50), -- 'manual', 'whatsapp', 'bank_sync', 'ocr'
  bank_transaction_id VARCHAR(255),
  receipt_image_url TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Índices para optimizar queries
CREATE INDEX idx_transactions_user_date ON transactions(user_id, date DESC);
CREATE INDEX idx_transactions_category ON transactions(category);
CREATE INDEX idx_transactions_source ON transactions(source);

-- Tabla de patrones aprendidos
CREATE TABLE user_patterns (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  pattern_type VARCHAR(50), -- 'lunch', 'commute', 'subscription'
  pattern_data JSONB, -- Datos del patrón
  confidence DECIMAL(3,2), -- 0.0-1.0
  last_detected TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Tabla de notificaciones
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  type VARCHAR(50), -- 'alert', 'suggestion', 'achievement', etc.
  priority VARCHAR(20), -- 'low', 'medium', 'high'
  title VARCHAR(255) NOT NULL,
  body TEXT NOT NULL,
  action VARCHAR(100),
  read BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Tabla de logros
CREATE TABLE achievements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  achievement_type VARCHAR(100), -- 'eco_warrior', 'saver_ninja', etc.
  level INT DEFAULT 1,
  unlocked_at TIMESTAMP DEFAULT NOW(),
  points INT DEFAULT 0
);

-- Tabla de conexiones bancarias
CREATE TABLE bank_connections (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  bank_name VARCHAR(255),
  institution_id VARCHAR(255),
  access_token TEXT, -- Encriptado
  last_sync TIMESTAMP,
  status VARCHAR(50), -- 'connected', 'disconnected', 'error'
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Vista para resumen mensual
CREATE VIEW monthly_summary AS
SELECT 
  user_id,
  DATE_TRUNC('month', date) as month,
  SUM(amount) as total_spent,
  SUM(co2_impact) as total_co2,
  COUNT(*) as transaction_count,
  jsonb_object_agg(category, category_total) as by_category
FROM (
  SELECT 
    user_id,
    date,
    category,
    amount,
    co2_impact,
    SUM(amount) OVER (PARTITION BY user_id, DATE_TRUNC('month', date), category) as category_total
  FROM transactions
) subquery
GROUP BY user_id, DATE_TRUNC('month', date);

-- Función para calcular proyección mensual
CREATE OR REPLACE FUNCTION calculate_monthly_projection(p_user_id UUID, p_month DATE)
RETURNS TABLE(current_spent DECIMAL, projected_total DECIMAL, days_left INT) AS $$
DECLARE
  v_days_in_month INT;
  v_days_passed INT;
  v_current_spent DECIMAL;
  v_avg_daily DECIMAL;
BEGIN
  -- Obtener días del mes y días transcurridos
  v_days_in_month := EXTRACT(DAY FROM (DATE_TRUNC('month', p_month) + INTERVAL '1 month' - INTERVAL '1 day'));
  v_days_passed := EXTRACT(DAY FROM CURRENT_DATE);
  
  -- Calcular gasto actual
  SELECT COALESCE(SUM(amount), 0) INTO v_current_spent
  FROM transactions
  WHERE user_id = p_user_id
    AND DATE_TRUNC('month', date) = DATE_TRUNC('month', p_month);
  
  -- Calcular promedio diario
  v_avg_daily := v_current_spent / v_days_passed;
  
  -- Retornar resultados
  RETURN QUERY
  SELECT 
    v_current_spent,
    v_avg_daily * v_days_in_month,
    v_days_in_month - v_days_passed;
END;
$$ LANGUAGE plpgsql;
```

***

## Plan de Desarrollo para el Hackathon (Actualizado)

### Fase 1: Fundamentos y Setup (4-6 horas)

**Prioridad ALTA**

```
✅ 1.1 Setup del proyecto
   - Crear proyecto Next.js con TypeScript
   - Configurar Tailwind CSS + Shadcn/ui
   - Setup Supabase (DB + Auth)
   - Configurar variables de entorno

✅ 1.2 Estructura base
   - Layout principal
   - Sistema de rutas
   - Componentes UI base (botones, cards, forms)
   
✅ 1.3 Autenticación
   - Login/Signup (Supabase Auth)
   - Protección de rutas
   - Estado global de usuario

✅ 1.4 Base de datos
   - Crear tablas en Supabase
   - Seed con datos de prueba
   - APIs base (CRUD transacciones)
```

***

### Fase 2: Recopilación Sin Fricción (8-10 horas)

**Prioridad ALTA - Feature diferenciador**

```
✅ 2.1 WhatsApp Bot (4 horas)
   - Configurar Twilio API
   - Crear webhook en Next.js API routes
   - Integrar GPT-4o-mini para NLP
   - Testing con números reales
   - [DEMO-READY: Probar en vivo durante pitch]

✅ 2.2 Simulación Bancaria (2 horas)
   - Mock de transacciones realistas
   - Botón "Sincronizar Banco" con animación
   - Categorización automática con IA
   - Notificación de sincronización
   - [DEMO-READY: Mostrar antes/después]

✅ 2.3 OCR de Tickets (2 horas)
   - Componente de cámara/upload
   - Integración Tesseract.js (más rápido para demo)
   - Procesamiento con GPT-4 Vision
   - UI de confirmación
   - [DEMO-READY: Escanear ticket en vivo]

✅ 2.4 Widget y Quick Actions (1 hora)
   - Botones de gasto rápido
   - Formulario simplificado
   - Accesos directos
```

***

### Fase 3: Dashboard Dual + IA (6-8 horas)

**Prioridad ALTA**

```
✅ 3.1 Dashboard Financiero (2 horas)
   - Resumen de gasto mensual
   - Gráfica por categorías (Recharts)
   - Proyección automática
   - Comparativa vs mes anterior

✅ 3.2 Dashboard Ecológico (2 horas)
   - Calculadora de CO2
   - Visualización de huella de carbono
   - Equivalencias tangibles (árboles, km auto)
   - Comparativa vs promedio

✅ 3.3 Motor de Recomendaciones IA (3 horas)
   - Integración OpenAI API
   - Generación de consejos contextuales
   - Sistema de notificaciones inteligentes
   - [DEMO-READY: Mostrar recomendación en tiempo real]

✅ 3.4 Timeline de Transacciones (1 hora)
   - Lista cronológica
   - Filtros por categoría/fecha
   - Detalles de transacción
```

***

### Fase 4: Pulido y Preparación del Pitch (4-6 horas)

**Prioridad MEDIA-ALTA**

```
✅ 4.1 UX/UI Polish (2 horas)
   - Animaciones con Framer Motion
   - Estados de carga elegantes
   - Feedback visual
   - Responsive design
   - Dark mode

✅ 4.2 Datos de Demo Realistas (1 hora)
   - Crear seed script con transacciones variadas
   - Escenarios de demostración preparados
   - Usuario demo con datos completos

✅ 4.3 Testing y Bugs (1 hora)
   - Flujo completo de usuario
   - Edge cases
   - Performance

✅ 4.4 Materiales de Pitch (2 horas)
   - Slides del pitch (10-12 slides)
   - Video demo (2-3 min)
   - Script de presentación
   - FAQs preparadas
```

***

### Fase 5: Features Bonus (Si hay tiempo)

**Prioridad BAJA - Nice to have**

```
⭐ 5.1 Gamificación
   - Sistema de logros
   - Badges visuales
   - Puntos y niveles

⭐ 5.2 Comparador de Rutas
   - Calculadora de transporte
   - Comparación en tiempo real
   - Mapas interactivos

⭐ 5.3 Análisis de Patrones
   - Detección automática de rutinas
   - Sugerencias predictivas
   - Machine learning light
```

***

## Distribución de Tiempo (Hackathon 32 horas)

```
Viernes Noche (6 horas):
  18:00-24:00: Fase 1 completa (Setup + Base)

Sábado (12 horas):
  08:00-12:00: Fase 2 (Recopilación datos)
  12:00-14:00: Break + comida
  14:00-18:00: Fase 3 parte 1 (Dashboards)
  18:00-20:00: Break + cena
  20:00-24:00: Fase 3 parte 2 (IA + Testing)

Domingo (14 horas):
  08:00-12:00: Fase 4 (Polish + UX)
  12:00-14:00: Break + comida
  14:00-17:00: Pitch materials
  17:00-20:00: Ensayos y ajustes finales
  20:00-22:00: Buffer / Features bonus si hay tiempo

Total: 32 horas distribuidas estratégicamente
```

***

## Narrativa para el Pitch (Actualizada)

### Estructura del Pitch (5-7 minutos)

**Slide 1: El Problema (30 seg)**
```
"Levanten la mano si usan app de finanzas personales..."
[Pocas manos]

"¿Por qué? Porque requieren DISCIPLINA DIARIA"
- Registrar cada gasto manualmente
- Abrir la app 5-10 veces al día
- Categorizar todo
- Generar reportes

Resultado: 80% abandonan en la primera semana
```

**Slide 2: El Problema Oculto (30 seg)**
```
"Pero hay un problema más grande:

No vemos el IMPACTO REAL de nuestras decisiones
- ¿Cuánto CO2 genero con mis gastos?
- ¿Qué alternativas existen?
- ¿Cómo afectan mis decisiones al planeta?

Las apps tradicionales: SOLO $$$ 💰
La realidad: Cada peso tiene huella ambiental 🌍"
```

**Slide 3: La Solución - Spendly (45 seg)**
```
"Spendly: Finanzas inteligentes que trabajan para ti

3 Pilares Revolucionarios:

1️⃣ RECOPILACIÓN AUTOMÁTICA
   No registras, la app lo hace por ti

2️⃣ DOBLE IMPACTO
   Cada gasto muestra: 💰 + 🌍

3️⃣ IA PROACTIVA
   Recomendaciones en el momento justo"
```

**Slide 4-7: DEMO EN VIVO (3 min)**
```
[DEMO 1: WhatsApp Bot]
"Miren esto..." [Proyectar WhatsApp]
[Alguien del público envía: "150 uber"]
[Bot responde en <2 seg con categorización + consejo]
[Dashboard se actualiza en pantalla en tiempo real]

"Tardó 3 segundos. Apps tradicionales: 30-60 segundos"

---

[DEMO 2: Sincronización Bancaria]
[Mostrar dashboard vacío]
[Click en "Sincronizar Banco"]
[Animación 2-3 seg]
[30+ transacciones aparecen categorizadas]

"32 transacciones importadas
CERO minutos de tu tiempo
TODO categorizado automáticamente"

---

[DEMO 3: Recomendación IA]
[Registrar: $200 Uber]
[Notificación aparece instantáneamente]

"💡 Oportunidad: Transporte público
Ahorro: $185
CO2: -78kg
Tiempo: +15min

¿Vale la pena? TÚ decides con INFORMACIÓN REAL"

---

[DEMO 4: Dashboard Dual]
[Mostrar gráficas lado a lado]

"Panel financiero: Gastaste $2,340
Panel ecológico: Generaste 780kg CO2

Equivale a:
🌳 35 árboles por plantar
🚗 3,200 km en auto
⚡ 2,600 kWh de energía

CONTEXTO que motiva cambio"
```

**Slide 8: El Diferenciador (30 seg)**
```
"Otras apps te dicen:
'Gastaste $200 en transporte' 📊

Spendly te dice:
'Gastaste $200 en transporte
Generaste 80kg CO2
Transporte público ahorra $140 y 60kg CO2
¿Quieres activar Smart Commute?' 

DATOS + CONTEXTO + ACCIÓN = CAMBIO REAL"
```

**Slide 9: Impacto (45 seg)**
```
"Impacto Medible:

Personal:
💰 15-30% ahorro en gastos variables
⏱️ 95% menos tiempo registrando gastos

Ambiental:
🌍 20% reducción en huella de carbono
🚇 40% más uso de transporte sostenible

Social:
📱 80% retención (vs 20% de apps tradicionales)
🌱 Millones de usuarios = impacto real"
```

**Slide 10: Tecnología (30 seg)**
```
"Stack Inteligente:

🤖 IA: GPT-4o-mini para NLP
📱 WhatsApp Bot: Twilio API
💳 Banking: Plaid/Belvo (simulado)
📊 Dashboard: Next.js + Recharts
🔔 Notificaciones: Contextuales e inteligentes

Todo diseñado para SER INVISIBLE"
```

**Slide 11: Modelo de Negocio (30 seg)**
```
"Monetización Sostenible:

Freemium:
Free: Registro manual, 3 recomendaciones/semana
Premium ($3.99/mes): Integración bancaria, IA ilimitada

B2B:
💼 API de cálculo CO2 para fintechs
🤝 Partnerships con apps de movilidad

Escalabilidad:
🌎 10M+ usuarios urbanos en LATAM
💰 LTV estimado: $48/año"
```

**Slide 12: Visión (30 seg)**
```
"La Visión:

CORTO PLAZO (6 meses):
- Lanzamiento Beta en MTY
- 10K usuarios activos
- Integración con bancos mexicanos

MEDIANO PLAZO (1 año):
- Expansión LATAM
- Marketplace de productos eco-friendly
- Programa de rewards

LARGO PLAZO:
Convertir Spendly en LA app de referencia
para la generación que quiere cuidar
su economía Y el planeta

'Your money, your impact, your choice' 💚"
```

***

## Métricas de Éxito (Actualiz adas)

### Métricas de Fricción (Lo más importante)

```
📊 Tiempo promedio de registro:
Tradicional: 30-60 seg/transacción
Spendly: 3-5 seg/transacción
Mejora: 90%+ ✅

📊 % Transacciones automáticas:
Meta: 80%+
Con integración bancaria: 85%
Con WhatsApp Bot: 95% ✅

📊 Interacciones requeridas/día:
Tradicional: 5-10
Spendly: 0-2
Mejora: 80%+ ✅

📊 Tasa de retención semanal:
Tradicional: 20%
Spendly (proyectado): 80%
Mejora: 4x ✅
```

### Métricas de Impacto

```
💰 Ahorro promedio generado:
Target: $300-$750/mes

🌍 Reducción CO2 promedio:
Target: 15-25% vs baseline

🚇 Adopción transporte sostenible:
Target: +40% vs comportamiento previo

⭐ NPS (Net Promoter Score):
Target: 60+ (excelente)
```

***

## Checklist Final Pre-Pitch

```
DEMO:
☐ WhatsApp Bot funcionando con número real
☐ Dashboard con datos realistas precargados
☐ Simulación bancaria lista (animación fluida)
☐ OCR probado con ticket físico real
☐ Notificaciones de IA funcionando
☐ Todos los flujos testeados 3+ veces

MATERIALES:
☐ Slides finalizados (diseño limpio)
☐ Video backup (si falla demo en vivo)
☐ Script memorizado
☐ FAQs preparadas
☐ Business card/QR code para seguimiento

TÉCNICO:
☐ Internet backup (hotspot móvil)
☐ Laptop cargada 100%
☐ Proyector/adaptadores testeados
☐ Cuenta demo creada y probada
☐ Logs de error monitoreados

EQUIPO:
☐ Roles definidos (quién presenta qué)
☐ Timing ensayado (5-7 min exactos)
☐ Transiciones pulidas
☐ Respuestas a preguntas comunes preparadas
```